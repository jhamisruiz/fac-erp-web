<p-dialog header="unspsc" [(visible)]="visible" [modal]="true" [style]="{ width: '80vw' }" [draggable]="false"
  [resizable]="false" [position]="'top'" [breakpoints]="{ '960px': '100vw' }">
  <div class="row gy-4 pt-3">
    <div class="mt-3 col-xxl-12 col-md-12" *ngIf="(loading$ | async)">
      <p-progressSpinner styleClass="w-4rem h-4rem" strokeWidth="3" animationDuration=".4s">
      </p-progressSpinner>
    </div>
    <div class="mt-3 col-xxl-4 col-md-6">
      <div class="form-group">
        <span class="mb-0 pb-0">SEGMENTO</span>
        <div class="cal-icon">
          <p-dropdown appendTo="body" (onChange)="getSegmentoToFamilia()" [options]="segmentos"
            styleClass="p-0 w-100 {{layoutMode==='dark'?'form-control':''}}"
            [style]="{'width':'100%','min-width':'100%'}" [(ngModel)]="segmento" optionLabel="descripcion"
            [filter]="true" filterBy="descripcion" [showClear]="true" placeholder="Select. Segmento">
            <ng-template pTemplate="selectedItem">
              <div class="seg-item seg-item-value d-flex" *ngIf="segmento">
                <p-badge *ngIf="segmento?.codigo" [value]="twoWords(segmento?.codigo, 2)" severity="info"
                  styleClass="m-0 mr-1">
                </p-badge>
                <div class="p-lg-1">{{segmento?.descripcion}}</div>
              </div>
            </ng-template>
            <ng-template let-seg pTemplate="item">
              <div class="seg-item d-flex">
                <p-badge *ngIf="seg?.codigo" [value]="twoWords(seg?.codigo, 2)" severity="info" styleClass="m-0 mr-1">
                </p-badge>
                <div class="p-lg-1">{{seg?.descripcion}}</div>
              </div>
            </ng-template>
          </p-dropdown>
        </div>
      </div>
    </div>
    <div class="mt-3 col-xxl-4 col-md-6">
      <div class="form-group">
        <span class="mb-0 pb-0">FAMILIA</span>
        <div class="cal-icon">
          <p-dropdown appendTo="body" (onChange)="getFamiliaToClase()" [options]="familias"
            styleClass="p-0 w-100 {{layoutMode==='dark'?'form-control':''}}"
            [style]="{'width':'100%','min-width':'100%'}" [(ngModel)]="familia" optionLabel="descripcion"
            [filter]="true" filterBy="descripcion" [showClear]="true" placeholder="Select. Familia">
            <ng-template pTemplate="selectedItem">
              <div class="fam-item fam-item-value d-flex" *ngIf="familia">
                <p-badge *ngIf="familia?.codigo" [value]="twoWords(familia?.codigo, 4)" severity="info"
                  styleClass="m-0 mr-2">
                </p-badge>
                <div class="p-lg-1">{{familia?.descripcion}}</div>
              </div>
            </ng-template>
            <ng-template let-fam pTemplate="item">
              <div class="fam-item d-flex">
                <p-badge *ngIf="fam?.codigo" [value]="twoWords(fam?.codigo, 4)" severity="info" styleClass="m-0 mr-1">
                </p-badge>
                <div class="p-lg-1">{{fam?.descripcion}}</div>
              </div>
            </ng-template>
          </p-dropdown>
        </div>
      </div>
    </div>
    <div class="mt-3 col-xxl-4 col-md-6">
      <div class="form-group">
        <span class="mb-0 pb-0">CLASE</span>
        <div class="cal-icon">
          <p-dropdown appendTo="body" (onChange)="getClaseToProd()" (onClear)="getClaseToProd()" [options]="clases"
            styleClass="p-0 w-100 {{layoutMode==='dark'?'form-control':''}}"
            [style]="{'width':'100%','min-width':'100%'}" [(ngModel)]="clase" optionLabel="descripcion" [filter]="true"
            filterBy="descripcion" [showClear]="true" placeholder="Select. Clase">
            <ng-template pTemplate="selectedItem">
              <div class="fam-item fam-item-value d-flex" *ngIf="clase">
                <p-badge *ngIf="clase?.codigo" [value]="twoWords(clase.codigo, 6)" severity="info"
                  styleClass="m-0 mr-1">
                </p-badge>
                <div class="p-lg-1">{{clase.descripcion}}</div>
              </div>
            </ng-template>
            <ng-template let-cl pTemplate="item">
              <div class="cl-item d-flex">
                <p-badge *ngIf="cl?.codigo" [value]="twoWords(cl?.codigo, 6)" severity="info" styleClass="m-0 mr-1">
                </p-badge>
                <div class="p-lg-1">{{cl?.descripcion}}</div>
              </div>
            </ng-template>
          </p-dropdown>
        </div>
      </div>
    </div>
    <div class="mt-3 col-xxl-1 col-md-2 d-flex align-items-end">
      <p-button [styleClass]="'w-100'" label="Limpiar" [rounded]="true" severity="help"></p-button>
    </div>

    <div class="mt-3 col-xxl-12 col-md-12">
      <div class="form-group">
        <span class="mb-0 pb-0">PRODUCTO</span>
        <div class="cal-icon" *ngIf="clase?.codigo || producto?.codigo">
          <p-dropdown appendTo="body" (onChange)="getProducto()" (onClear)="getProducto()" [options]="productos"
            styleClass="p-0 w-100 {{layoutMode==='dark'?'form-control':''}}"
            [style]="{'width':'100%','min-width':'100%'}" [(ngModel)]="producto" optionLabel="descripcion"
            [filter]="true" filterBy="descripcion" [showClear]="true" placeholder="Select. Producto">
            <ng-template pTemplate="selectedItem">
              <div class="pr-item pr-item-value d-flex" *ngIf="producto">
                <p-badge *ngIf="producto?.codigo" [value]="twoWords(producto?.codigo, 8)" severity="info"
                  styleClass="m-0 mr-1">
                </p-badge>
                <div class="p-lg-1">{{producto?.descripcion}}</div>
              </div>
            </ng-template>
            <ng-template let-pr pTemplate="item">
              <div class="pr-item d-flex">
                <p-badge *ngIf="pr?.codigo" [value]="twoWords(pr?.codigo, 8)" severity="info" styleClass="m-0 mr-1">
                </p-badge>
                <div class="">{{pr?.descripcion}}</div>
              </div>
            </ng-template>
          </p-dropdown>
        </div>
        <div class="cal-icon" *ngIf="!(clase?.codigo) && !(producto?.codigo)">
          <p-autoComplete appendTo="body" [(ngModel)]="producto" [suggestions]="productos"
            [inputStyle]="{'width': '100%', 'min-width': '100px' }" [style]="{'width':'100%','min-width':'100%'}"
            inputStyleClass="p-0 w-100 {{layoutMode==='dark'?'form-control':''}}"
            (onSelect)="getSuggstProducto($event,'onSelect')" (completeMethod)="suggestProds($event)"
            [dataKey]="'codigo'" [attr.optionValue]="'codigo'" [field]="'descripcion'" [minLength]="1"
            [forceSelection]="true">
            <ng-template let-value pTemplate="item">
              <span style="font-size:11px; text-transform: uppercase;" class="pt-1 pb-1">
                <p-badge *ngIf="value?.codigo" [value]="(value?.codigo ?? '')" severity="info" styleClass="m-0 mr-1">
                </p-badge>
                {{value?.descripcion}}
              </span>
            </ng-template>
          </p-autoComplete>
        </div>
      </div>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <p-button (click)="visible = false" label="Cerrar" styleClass="p-button-text p-button-danger"></p-button>
  </ng-template>
</p-dialog>
